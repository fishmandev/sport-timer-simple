<!DOCTYPE html>
<html>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <button id="start">Start</button>
  <div class="container">
    <div class="center">
      <div class="item html">
        <h1></h1>
        <svg width="160" height="160" xmlns="http://www.w3.org/2000/svg">
          <g>
            <title>Layer 1</title>
            <circle id="circle" class="circle_animation" r="69.85699" cy="81" cx="81" stroke-width="15" stroke="#6fdb6f"
              fill="none" />
          </g>
        </svg>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
    integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
  <script>
    const downtime = (time, color) => {
      const wakeLock = async () => {
        if ('wakeLock' in navigator) {
          return await navigator.wakeLock.request();
        }
        return false;
      }
      return new Promise(resolve => {
        const wakeLockHandler = wakeLock();
        $('.circle_animation').css('stroke', color);
        $('.center').show();
        $('h1').text(time);
        let initialOffset = '440';
        let i = 1;

        /* Need initial run as interval hasn't yet occured... */
        $('.circle_animation').css('stroke-dashoffset', initialOffset - (1 * (initialOffset / time)));
        let interval = setInterval(function () {
          $('h1').text(time - i);
          if (i == time) {
            clearInterval(interval);
            wakeLockHandler.then(wakeLock => {
              wakeLock && wakeLock.release();
            }); 
          }
          if (i < time) {
            $('.circle_animation').css('stroke-dashoffset', initialOffset - ((i + 1) * (initialOffset / time)));
            i++;
          } else {
            $('.center').hide();
            $('.circle_animation').css('stroke-dashoffset', 440);
            let x = setInterval(() => {
              clearInterval(x);  
              return resolve();
            }, 100);
          }
        }, 1000);
      });
    };

    $('#start').click(async () => {
      await downtime(5, "#6fdb6f");
      await downtime(10, "#84b8f0");
    });
  </script>
</body>

</html>